---
const { className } = Astro.props;
const pathname = new URL(Astro.request.url).pathname;

const navLinks = [
  { name: "ABOUT", href: "/#about" },
  { name: "EVENTS", href: "/events" },
  { name: "NEWSLETTERS", href: "/newsletters" },
  { name: "EXECOM", href: "/execom" },
  { name: "CHAPTERS", href: "/chapters" },
  { name: "CONTACT", href: "/contact" },
];

const isActive = (href: string) => {
  if (href === "/#about" && pathname === "/") return true;
  if (href === "/" && pathname === "/") return true;
  return href !== "/" && pathname.startsWith(href);
};
---

<!--
 * Website for IEEE SB CETKR
 * Copyright (C) 2025 IEEE Student Branch CETKR
 -->
<header
  id="main-header"
  class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${className || ""} bg-transparent border-b border-transparent`}
>
  <div
    class="absolute inset-0 bg-white/70 backdrop-blur-md border-b border-zinc-200/50 opacity-0 transition-opacity duration-500 shadow-sm"
    id="header-bg"
  >
  </div>

  <nav
    class="container mx-auto px-6 py-4 flex justify-between items-center relative z-10"
  >
    <!-- Logo -->
    <a
      href="/"
      class="flex items-center gap-3 hover:opacity-80 transition-all duration-300 group"
    >
      <img
        src="/SB_LOGO_B.png"
        alt="IEEE SB CETKR logo"
        class="w-10 h-10 object-contain"
        width="40"
        height="40"
      />
      <!-- Note: Assuming SB_LOGO_NO_BG is the dark version or suitable for light theme. If not, text only fallback or invert filter needed. -->
      <!-- Since I can't check image contents, I will enforce text color for safety -->
      <span class="text-xl font-medium tracking-wide text-zinc-900">
        <span class="font-bold text-blue-600">IEEE</span> SB CETKR
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center">
      <nav
        class="flex items-center p-1 rounded-full border border-zinc-200 bg-white/50 backdrop-blur-xl shadow-sm"
      >
        {
          navLinks.map((link) => {
            const active = isActive(link.href);
            return (
              <a
                href={link.href}
                class={`
                relative px-5 py-2 text-xs font-semibold rounded-full transition-all duration-300 tracking-wide
                ${
                  active
                    ? "text-white bg-zinc-900 shadow-lg shadow-zinc-900/20"
                    : "text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100/50"
                }
              `}
                aria-current={active ? "page" : undefined}
              >
                {link.name}
              </a>
            );
          })
        }
      </nav>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-button"
      class="md:hidden flex items-center justify-center w-10 h-10 rounded-full hover:bg-zinc-100 transition-colors focus:outline-none text-zinc-900"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <div class="w-5 h-4 flex flex-col justify-between relative">
        <span
          class="w-full h-0.5 bg-zinc-900 transition-all duration-300 origin-left"
          id="hamburger-top"></span>
        <span
          class="w-full h-0.5 bg-zinc-900 transition-all duration-300"
          id="hamburger-middle"></span>
        <span
          class="w-full h-0.5 bg-zinc-900 transition-all duration-300 origin-left"
          id="hamburger-bottom"></span>
      </div>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="md:hidden absolute top-full left-0 right-0 overflow-hidden transition-[max-height,opacity] duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] max-h-0 opacity-0 bg-white/95 border-b border-zinc-200 backdrop-blur-2xl shadow-xl"
  >
    <div class="px-6 py-8 space-y-1 flex flex-col">
      {
        navLinks.map((link) => {
          const active = isActive(link.href);
          return (
            <a
              href={link.href}
              class={`
              block px-4 py-3 rounded-lg text-sm font-semibold transition-all duration-300
              ${
                active
                  ? "text-blue-600 bg-blue-50 border border-blue-100 pl-6"
                  : "text-zinc-500 hover:text-zinc-900 hover:bg-zinc-50 hover:pl-6"
              }
            `}
              aria-current={active ? "page" : undefined}
            >
              {link.name}
            </a>
          );
        })
      }
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("main-header");
  const headerBg = document.getElementById("header-bg");
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const hamburgerTop = document.getElementById("hamburger-top");
  const hamburgerMiddle = document.getElementById("hamburger-middle");
  const hamburgerBottom = document.getElementById("hamburger-bottom");

  // Scroll effect
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      headerBg?.classList.remove("opacity-0");
      headerBg?.classList.add("opacity-100");
    } else {
      headerBg?.classList.add("opacity-0");
      headerBg?.classList.remove("opacity-100");
    }
  });

  // Mobile menu toggle
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", (e) => {
      e.stopPropagation();
      const isExpanded =
        mobileMenuButton.getAttribute("aria-expanded") === "true";

      // Update aria state
      mobileMenuButton.setAttribute("aria-expanded", (!isExpanded).toString());

      // Toggle menu visibility
      if (!isExpanded) {
        mobileMenu.classList.remove("max-h-0", "opacity-0");
        mobileMenu.classList.add("max-h-[600px]", "opacity-100");

        // Animate hamburger to X
        hamburgerTop?.classList.add("rotate-45", "translate-x-px");
        hamburgerMiddle?.classList.add("opacity-0");
        hamburgerBottom?.classList.add("-rotate-45", "translate-x-px");
      } else {
        closeMenu();
      }
    });

    // Close on link click
    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    // Close on click outside
    document.addEventListener("click", (e) => {
      if (!header?.contains(e.target as Node)) {
        closeMenu();
      }
    });
  }

  function closeMenu() {
    if (!mobileMenu || !mobileMenuButton) return;

    mobileMenuButton.setAttribute("aria-expanded", "false");
    mobileMenu.classList.add("max-h-0", "opacity-0");
    mobileMenu.classList.remove("max-h-[600px]", "opacity-100");

    // Reset hamburger
    hamburgerTop?.classList.remove("rotate-45", "translate-x-px");
    hamburgerMiddle?.classList.remove("opacity-0");
    hamburgerBottom?.classList.remove("-rotate-45", "translate-x-px");
  }
</script>

---
const { className } = Astro.props;
const pathname = new URL(Astro.request.url).pathname;

const navLinks = [
  { name: "ABOUT", href: "/#about" },
  { name: "EVENTS", href: "/events" },
  { name: "EXECOM", href: "/execom" },
  { name: "CHAPTERS", href: "/chapters" },
  { name: "NEWSLETTERS", href: "/newsletters" },
  { name: "CONTACT", href: "/contact" },
];

const isActive = (href: string) => {
  if (href === "/#about" && pathname === "/") return true;
  if (href === "/" && pathname === "/") return true;
  return href !== "/" && pathname.startsWith(href);
};
---

<!--
 * Website for IEEE SB CETKR
 * Copyright (C) 2025 IEEE Student Branch CETKR
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program. If not, see <https://www.gnu.org/licenses/>.
-->
<header
  id="main-header"
  class={`fixed top-0 left-0 right-0 z-50 transition-all duration-300 ${className || ""} bg-slate-900/80 backdrop-blur-md border-b border-white/5`}
>
  <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
    <!-- Logo -->
    <a
      href="/"
      class="flex items-center gap-3 hover:scale-105 transition-transform duration-300 group"
    >
      <img
        src="/SB_LOGO_W.png"
        alt="IEEE SB CETKR logo"
        class="w-10 h-10 object-contain drop-shadow-[0_0_8px_rgba(34,211,238,0.3)] group-hover:drop-shadow-[0_0_12px_rgba(34,211,238,0.5)] transition-all"
        width="40"
        height="40"
      />
      <span
        class="text-2xl font-bold tracking-wider text-slate-100 group-hover:text-white transition-colors"
      >
        <span class="text-cyan-400 drop-shadow-[0_0_8px_rgba(34,211,238,0.3)]"
          >IEEE</span
        > SB CETKR
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center space-x-8">
      <nav class="flex items-center space-x-1">
        {
          navLinks.map((link) => {
            const active = isActive(link.href);
            return (
              <a
                href={link.href}
                class={`
                relative px-4 py-2 text-sm font-medium rounded-full transition-all duration-300
                ${
                  active
                    ? "text-cyan-400 bg-cyan-400/10 shadow-[0_0_10px_rgba(34,211,238,0.2)]"
                    : "text-slate-300 hover:text-white hover:bg-white/5"
                }
              `}
                aria-current={active ? "page" : undefined}
              >
                {link.name}
                {active && (
                  <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 bg-cyan-400 rounded-full shadow-[0_0_4px_rgba(34,211,238,0.5)] translate-y-2" />
                )}
              </a>
            );
          })
        }
      </nav>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-button"
      class="md:hidden flex items-center justify-center w-10 h-10 rounded-full hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-cyan-400"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <div class="w-5 h-4 flex flex-col justify-between relative">
        <span
          class="w-full h-0.5 bg-white rounded-full transition-all duration-300 origin-left"
          id="hamburger-top"></span>
        <span
          class="w-full h-0.5 bg-white rounded-full transition-all duration-300"
          id="hamburger-middle"></span>
        <span
          class="w-full h-0.5 bg-white rounded-full transition-all duration-300 origin-left"
          id="hamburger-bottom"></span>
      </div>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="md:hidden absolute top-full left-0 right-0 overflow-hidden transition-[max-height,opacity] duration-300 ease-in-out max-h-0 opacity-0 bg-slate-900/95 border-b border-white/10 backdrop-blur-xl"
  >
    <div class="px-6 py-6 space-y-2 flex flex-col">
      {
        navLinks.map((link) => {
          const active = isActive(link.href);
          return (
            <a
              href={link.href}
              class={`
              block px-4 py-3 rounded-lg text-base font-medium transition-all duration-200
              ${
                active
                  ? "text-cyan-400 bg-cyan-950/30 pl-6 border-l-2 border-cyan-400"
                  : "text-slate-300 hover:text-white hover:bg-white/5 hover:pl-6"
              }
            `}
              aria-current={active ? "page" : undefined}
            >
              {link.name}
            </a>
          );
        })
      }
      <div class="pt-4 mt-2 border-t border-white/10">
        <a
          href="/join"
          class="block w-full text-center py-3 bg-gradient-to-r from-cyan-600 to-blue-600 text-white font-semibold rounded-lg shadow-lg active:scale-95 transition-transform"
        >
          Join Our Community
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById("main-header");
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const hamburgerTop = document.getElementById("hamburger-top");
  const hamburgerMiddle = document.getElementById("hamburger-middle");
  const hamburgerBottom = document.getElementById("hamburger-bottom");

  // Scroll effect
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      header?.classList.add("shadow-lg", "bg-slate-900/95");
      header?.classList.remove("bg-slate-900/80");
    } else {
      header?.classList.remove("shadow-lg", "bg-slate-900/95");
      header?.classList.add("bg-slate-900/80");
    }
  });

  // Mobile menu toggle
  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener("click", (e) => {
      e.stopPropagation();
      const isExpanded =
        mobileMenuButton.getAttribute("aria-expanded") === "true";

      // Update aria state
      mobileMenuButton.setAttribute("aria-expanded", (!isExpanded).toString());

      // Toggle menu visibility
      if (!isExpanded) {
        mobileMenu.classList.remove("max-h-0", "opacity-0");
        mobileMenu.classList.add("max-h-[500px]", "opacity-100");

        // Animate hamburger to X
        hamburgerTop?.classList.add("rotate-45", "translate-x-px");
        hamburgerMiddle?.classList.add("opacity-0");
        hamburgerBottom?.classList.add("-rotate-45", "translate-x-px");
      } else {
        closeMenu();
      }
    });

    // Close on link click
    mobileMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu);
    });

    // Close on click outside
    document.addEventListener("click", (e) => {
      if (!header?.contains(e.target as Node)) {
        closeMenu();
      }
    });
  }

  function closeMenu() {
    if (!mobileMenu || !mobileMenuButton) return;

    mobileMenuButton.setAttribute("aria-expanded", "false");
    mobileMenu.classList.add("max-h-0", "opacity-0");
    mobileMenu.classList.remove("max-h-[500px]", "opacity-100");

    // Reset hamburger
    hamburgerTop?.classList.remove("rotate-45", "translate-x-px");
    hamburgerMiddle?.classList.remove("opacity-0");
    hamburgerBottom?.classList.remove("-rotate-45", "translate-x-px");
  }
</script>

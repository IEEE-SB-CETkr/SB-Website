---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

// 1. Capture 'now' once for consistent filtering
const now = new Date();

// 2. Fetch and Sort
const allEvents = await getCollection("events");

const upcomingEvents = allEvents
  .filter((e) => e.data.eventDate >= now)
  .sort((a, b) => a.data.eventDate.getTime() - b.data.eventDate.getTime());

const pastEvents = allEvents
  .filter((e) => e.data.eventDate < now)
  .sort((a, b) => b.data.eventDate.getTime() - a.data.eventDate.getTime());

// 3. Reusable Formatter
const dateFormatter = new Intl.DateTimeFormat("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const pageTitle = "Events | IEEE SB CETKR";
const pageDescription = "Upcoming and past events organized by IEEE SB CETKR";
---

<Header />
<Layout title={pageTitle} description={pageDescription}>
  <!-- Background Elements -->
  <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
    <div
      class="absolute top-0 right-[10%] w-[500px] h-[500px] bg-cyan-500/5 rounded-full blur-[100px]"
    >
    </div>
    <div
      class="absolute bottom-0 left-[10%] w-[500px] h-[500px] bg-blue-600/5 rounded-full blur-[100px]"
    >
    </div>
  </div>

  <main class="min-h-screen relative z-10">
    <section class="relative pt-40 pb-20 overflow-hidden">
      <div class="absolute inset-0 z-0">
        <div
          class="absolute inset-0 bg-[url('/images/grid.svg')] opacity-10 [mask-image:linear-gradient(180deg,white,rgba(255,255,255,0))]"
        >
        </div>
      </div>

      <div class="container mx-auto px-6 relative z-10 text-center">
        <div data-aos="fade-down" data-aos-duration="1000">
          <span
            class="inline-block px-4 py-1.5 rounded-full border border-cyan-500/30 bg-cyan-500/10 text-cyan-300 text-sm font-medium mb-6 backdrop-blur-sm"
          >
            Join Us
          </span>
        </div>

        <h1
          class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight"
          data-aos="fade-up"
          data-aos-duration="1000"
          data-aos-delay="100"
        >
          Our <span class="gradient-text font-extrabold">Events</span>
        </h1>

        <p
          class="text-lg md:text-xl text-slate-300 mb-10 max-w-2xl mx-auto leading-relaxed"
          data-aos="fade-up"
          data-aos-duration="1000"
          data-aos-delay="200"
        >
          Join us for exciting technical events, workshops, and competitions
          organized by the IEEE Student Branch at College of Engineering
          Trikaripur.
        </p>
      </div>
    </section>

    {
      upcomingEvents.length > 0 && (
        <section class="py-16 bg-slate-900">
          <div class="container mx-auto px-6 max-w-7xl">
            <h2 class="text-2xl md:text-3xl font-bold text-white mb-8 flex items-center">
              <span class="w-2 h-8 bg-cyan-400 rounded-full mr-3 shadow-[0_0_15px_rgba(34,211,238,0.5)]" />
              Upcoming Events
            </h2>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {upcomingEvents.map((event) => (
                <article class="group relative flex flex-col h-full bg-slate-800/50 backdrop-blur-sm rounded-2xl overflow-hidden border border-slate-700/50 hover:border-cyan-500/50 transition-all duration-300 hover:shadow-lg hover:shadow-cyan-500/10 hover:-translate-y-1">
                  <a
                    href={`/events/${event.slug}/`}
                    class="flex flex-col h-full"
                  >
                    {event.data.image && (
                      <div class="h-48 md:h-56 overflow-hidden bg-slate-700/30 relative">
                        <img
                          src={event.data.image.url}
                          alt={event.data.image.alt || event.data.title}
                          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                          loading="lazy"
                          decoding="async"
                        />
                        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/80 to-transparent opacity-60" />
                      </div>
                    )}

                    <div class="p-6 flex-1 flex flex-col">
                      <h3 class="text-xl font-bold text-white mb-3 group-hover:text-cyan-400 transition-colors line-clamp-2">
                        {event.data.title}
                      </h3>
                      <p class="text-slate-300 text-sm mb-6 line-clamp-2 flex-1">
                        {event.data.description}
                      </p>

                      <div class="pt-4 border-t border-slate-700/50 space-y-2">
                        <time
                          datetime={event.data.eventDate.toISOString()}
                          class="flex items-center text-sm text-slate-400"
                        >
                          <span class="material-icons text-base mr-2 text-cyan-400">
                            calendar_today
                          </span>
                          {dateFormatter.format(event.data.eventDate)}
                        </time>
                        {event.data.location && (
                          <div class="flex items-center text-sm text-slate-400">
                            <span class="material-icons text-base mr-2 text-cyan-400">
                              location_on
                            </span>
                            <span class="truncate">{event.data.location}</span>
                          </div>
                        )}
                      </div>
                    </div>
                  </a>
                </article>
              ))}
            </div>
          </div>
        </section>
      )
    }

    {
      pastEvents.length > 0 && (
        <section class="py-16 bg-slate-950 border-t border-slate-900">
          <div class="container mx-auto px-6 max-w-7xl">
            <h2 class="text-2xl md:text-3xl font-bold text-white mb-8 flex items-center opacity-90">
              <span class="w-2 h-8 bg-slate-600 rounded-full mr-3" />
              Past Events
            </h2>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {pastEvents.map((event) => (
                <article class="group flex flex-col h-full bg-slate-900/50 rounded-2xl overflow-hidden border border-slate-800 hover:border-slate-700 transition-all duration-300 hover:shadow-lg">
                  <a
                    href={`/events/${event.slug}/`}
                    class="flex flex-col h-full opacity-80 group-hover:opacity-100 transition-opacity"
                  >
                    {event.data.image && (
                      <div class="h-48 overflow-hidden bg-slate-800">
                        <img
                          src={event.data.image.url}
                          alt={event.data.image.alt || event.data.title}
                          class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-500"
                          loading="lazy"
                          decoding="async"
                        />
                      </div>
                    )}

                    <div class="p-6 flex-1 flex flex-col">
                      <h3 class="text-lg font-bold text-slate-200 mb-2 group-hover:text-cyan-400 transition-colors">
                        {event.data.title}
                      </h3>
                      <p class="text-slate-500 text-sm mb-4 line-clamp-2">
                        {event.data.description}
                      </p>

                      <div class="mt-auto pt-4 border-t border-slate-800">
                        <time
                          datetime={event.data.eventDate.toISOString()}
                          class="flex items-center text-sm text-slate-500"
                        >
                          <span class="material-icons text-base mr-2 text-slate-600">
                            event
                          </span>
                          {dateFormatter.format(event.data.eventDate)}
                        </time>
                      </div>
                    </div>
                  </a>
                </article>
              ))}
            </div>
          </div>
        </section>
      )
    }

    {
      allEvents.length === 0 && (
        <section class="py-32 text-center">
          <div class="container mx-auto px-6">
            <div class="max-w-md mx-auto p-8 bg-slate-900/50 rounded-3xl border border-slate-800">
              <span class="material-icons text-6xl text-slate-700 mb-4">
                event_busy
              </span>
              <h2 class="text-2xl font-bold text-white mb-2">
                No Events Scheduled
              </h2>
              <p class="text-slate-400">
                Check back later for upcoming workshops and tech talks.
              </p>
            </div>
          </div>
        </section>
      )
    }
  </main>
</Layout>
<Footer />

---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import Gallery from "../../components/Gallery.astro";

export async function getStaticPaths() {
  const events = await getCollection("events");
  return events.map((event) => ({
    params: { slug: event.slug },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await event.render();

// Destructure for cleaner template access
const {
  title,
  description,
  eventDate,
  image,
  location,
  registrationLink,
  gallery,
} = event.data;

const pageTitle = `${title} | IEEE SB CETKR`;
const pageDescription = description || `Details about ${title}`;

// Formatters
const dateStr = eventDate.toLocaleDateString("en-US", {
  weekday: "long",
  year: "numeric",
  month: "long",
  day: "numeric",
});
const timeStr = eventDate.toLocaleTimeString("en-US", {
  hour: "2-digit",
  minute: "2-digit",
});
---

<Header />

<Layout title={pageTitle} description={pageDescription} image={image?.url}>
  <main class="min-h-screen bg-slate-950 pt-24 pb-20 selection:bg-cyan-500/30">
    <div class="container mx-auto px-4 sm:px-6 max-w-6xl">
      <nav class="mb-8">
        <a
          href="/events"
          class="group inline-flex items-center text-slate-400 hover:text-cyan-400 transition-colors text-sm font-medium"
        >
          <span
            class="material-icons text-sm mr-2 group-hover:-translate-x-1 transition-transform"
          >
            arrow_back
          </span>
          Back to Events
        </a>
      </nav>

      <div class="grid lg:grid-cols-12 gap-10 lg:gap-14">
        <article class="lg:col-span-8 space-y-8">
          <header>
            <h1
              class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight tracking-tight"
            >
              {title}
            </h1>

            {
              image && (
                <div class="relative rounded-2xl overflow-hidden shadow-2xl border border-slate-700/50 mb-8 group max-w-2xl mx-auto">
                  <div class="absolute inset-0 bg-gradient-to-t from-slate-900/50 to-transparent pointer-events-none" />
                  <img
                    src={image.url}
                    alt={image.alt || title}
                    class="w-full h-auto max-h-[650px] object-contain mx-auto transform group-hover:scale-105 transition-transform duration-700"
                    loading="lazy"
                  />
                </div>
              )
            }
          </header>

          <div
            class="prose prose-lg prose-invert max-w-none prose-headings:text-white prose-p:text-slate-300 prose-a:text-cyan-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-white prose-li:text-slate-300 prose-em:text-white"
          >
            <Content />
          </div>

          {/* Gallery Section - Only render if gallery has items */}
          {
            gallery && gallery.length > 0 && (
              <section class="pt-12 mt-12 border-t border-slate-800/50">
                <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
                  <span class="material-icons text-cyan-500">
                    photo_library
                  </span>
                  Event Gallery
                </h2>
                <Gallery items={gallery ?? []} />
              </section>
            )
          }
        </article>

        <aside class="lg:col-span-4 relative">
          <div class="sticky top-28 space-y-6">
            <div
              class="bg-slate-900/80 backdrop-blur-sm rounded-2xl p-6 border border-slate-800 shadow-xl overflow-hidden relative"
            >
              <div
                class="absolute top-0 right-0 -mr-16 -mt-16 w-32 h-32 bg-cyan-500/10 rounded-full blur-2xl pointer-events-none"
              >
              </div>

              <h3
                class="text-lg font-semibold text-white mb-6 border-b border-slate-800 pb-4"
              >
                Event Details
              </h3>

              <div class="space-y-5">
                <div class="flex items-start group">
                  <span
                    class="material-icons text-cyan-500 mr-3 mt-0.5 group-hover:text-cyan-400 transition-colors"
                    >event</span
                  >
                  <div>
                    <p
                      class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-0.5"
                    >
                      Date
                    </p>
                    <p class="text-slate-200 font-medium">{dateStr}</p>
                  </div>
                </div>

                <div class="flex items-start group">
                  <span
                    class="material-icons text-cyan-500 mr-3 mt-0.5 group-hover:text-cyan-400 transition-colors"
                    >schedule</span
                  >
                  <div>
                    <p
                      class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-0.5"
                    >
                      Time
                    </p>
                    <p class="text-slate-200 font-medium">{timeStr}</p>
                  </div>
                </div>

                {
                  location && (
                    <div class="flex items-start group">
                      <span class="material-icons text-cyan-500 mr-3 mt-0.5 group-hover:text-cyan-400 transition-colors">
                        location_on
                      </span>
                      <div>
                        <p class="text-xs text-slate-500 uppercase font-bold tracking-wider mb-0.5">
                          Location
                        </p>
                        <p class="text-slate-200 font-medium">{location}</p>
                      </div>
                    </div>
                  )
                }
              </div>

              {
                registrationLink && (
                  <div class="mt-8 pt-6 border-t border-slate-800">
                    <a
                      href={registrationLink}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="group flex items-center justify-center w-full py-3.5 bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 text-white font-bold rounded-xl transition-all shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 hover:-translate-y-0.5"
                    >
                      Register Now
                      <span class="material-icons ml-2 text-sm group-hover:translate-x-1 transition-transform">
                        open_in_new
                      </span>
                    </a>
                  </div>
                )
              }
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>
</Layout>
<Footer />
